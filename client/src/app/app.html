<main class="main">
  <div class="content">
    <h1>Kursy walut (NBP)</h1>

    <form (ngSubmit)="submit(f)" #f="ngForm" class="form-grid">
      <label>
        <span>Kod waluty <span class="required">*</span></span>
        <input 
          name="currency" 
          [ngModel]="currency()" 
          (ngModelChange)="currency.set($event)" 
          placeholder="EUR" 
          required 
          minlength="3"
          maxlength="3"
          pattern="[A-Za-z]{3}"
          #currencyInput="ngModel" />
        @if (currencyInput.invalid && currencyInput.touched) {
          <span class="error-text">Kod waluty musi składać się z 3 liter</span>
        }
      </label>
      
      <label>
        <span>Imię i nazwisko <span class="required">*</span></span>
        <input 
          name="name" 
          [ngModel]="name()" 
          (ngModelChange)="name.set($event)" 
          placeholder="Jan Nowak" 
          required 
          minlength="2"
          maxlength="100"
          #nameInput="ngModel" />
        @if (nameInput.invalid && nameInput.touched) {
          <span class="error-text">Imię i nazwisko jest wymagane (2-100 znaków)</span>
        }
      </label>
      
      <button type="submit" [disabled]="loading() || f.invalid">
        @if (loading()) {
          <span>Ładowanie...</span>
        } @else {
          <span>Pobierz kurs</span>
        }
      </button>
    </form>

    @if (error()) {
      <div class="error-box">
        <strong>Błąd:</strong> {{ error() }}
        @if (validationErrors()) {
          <ul>
            @for (err of validationErrors(); track err.field) {
              <li>{{ err.field }}: {{ err.message }}</li>
            }
          </ul>
        }
      </div>
    }
    
    @if (result()) {
      <div class="success-box">
        Aktualny kurs <strong>{{ currency().toUpperCase() }}</strong>: 
        <strong class="rate-value">{{ result()?.value }} PLN</strong>
      </div>
    }

    <div class="section-header">
      <h2>Historia zapytań</h2>
      @if (totalElements() > 0) {
        <span class="count-badge">{{ totalElements() }} zapytań</span>
      }
    </div>

    @if (loadingRequests()) {
      <div class="loading-box">Ładowanie historii...</div>
    } @else if (requests().length) {
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Waluta</th>
              <th>Użytkownik</th>
              <th>Data</th>
              <th>Wartość</th>
            </tr>
          </thead>
          <tbody>
            @for (r of requests(); track r.date + r.currency) {
              <tr>
                <td><span class="currency-badge">{{ r.currency }}</span></td>
                <td>{{ r.name }}</td>
                <td>{{ r.date | date:'dd.MM.yyyy HH:mm' }}</td>
                <td class="value-cell">{{ r.value }} PLN</td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      @if (totalPages() > 1) {
        <div class="pagination">
          <button 
            (click)="previousPage()" 
            [disabled]="currentPage() === 0"
            class="pagination-btn">
            ← Poprzednia
          </button>
          <span class="pagination-info">
            Strona {{ currentPage() + 1 }} z {{ totalPages() }}
          </span>
          <button 
            (click)="nextPage()" 
            [disabled]="currentPage() >= totalPages() - 1"
            class="pagination-btn">
            Następna →
          </button>
        </div>
      }
    } @else {
      <div class="empty-state">
        <p>Brak zapisanych zapytań.</p>
        <p class="empty-hint">Wprowadź kod waluty powyżej, aby zobaczyć historię.</p>
      </div>
    }
  </div>
</main>